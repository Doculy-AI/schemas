{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.yuli.doculy.ai/v1/importers/spreadsheet.schema.json",
  "title": "Spreadsheet Importer Configuration",
  "description": "Configuration for importing CSV and Excel files into PostgreSQL",
  "type": "object",
  "x-parcell": {
    "service": "spreadsheet",
    "action": "import"
  },
  "required": ["file", "table"],
  "properties": {
    "parcell": {
      "$ref": "../common/base.schema.json#/$defs/parcell"
    },
    "file": {
      "type": "string",
      "description": "Path to spreadsheet file (local path, URL, or gs:// GCS path)",
      "examples": ["data.csv", "https://example.com/data.xlsx", "gs://bucket/file.csv"]
    },
    "table": {
      "type": "string",
      "pattern": "^[a-z_][a-z0-9_]*(\\.[a-z_][a-z0-9_]*)?$",
      "description": "Target PostgreSQL table name (schema.table format)",
      "examples": ["staging.imported_data", "my_table"]
    },
    "sheet": {
      "oneOf": [
        { "type": "string" },
        { "type": "integer" },
        {
          "type": "array",
          "items": {
            "oneOf": [
              { "type": "string" },
              { "type": "integer" }
            ]
          }
        }
      ],
      "description": "Sheet name or index for Excel files (0-based index)"
    },
    "extractFile": {
      "type": "string",
      "description": "File to extract from ZIP archive"
    },
    "sampleSize": {
      "type": "integer",
      "description": "Number of rows to analyze for type detection",
      "minimum": 1,
      "maximum": 10000,
      "default": 100
    },
    "primaryKey": {
      "type": "string",
      "description": "Column to use as primary key (original column name)"
    },
    "autoDetectPrimaryKey": {
      "type": "boolean",
      "description": "Auto-detect primary key from columns ending with '_id' or named 'id'",
      "default": false
    },
    "columnMappings": {
      "type": "object",
      "description": "Column name mappings (original -> target)",
      "additionalProperties": { "type": "string" }
    },
    "columnDefs": {
      "type": "object",
      "description": "Column type overrides",
      "additionalProperties": {
        "type": "string",
        "enum": ["string", "integer", "bigint", "decimal", "boolean", "date", "timestamp"]
      }
    },
    "includeCols": {
      "type": "array",
      "description": "Columns to include (imports all others if not specified)",
      "items": { "type": "string" }
    },
    "excludeCols": {
      "type": "array",
      "description": "Columns to exclude from import",
      "items": { "type": "string" }
    },
    "truncate": {
      "type": "boolean",
      "description": "Truncate table before import",
      "default": false
    },
    "batchSize": {
      "type": "integer",
      "description": "Batch size for inserts",
      "minimum": 1,
      "maximum": 10000,
      "default": 1000
    },
    "ignoreErrors": {
      "type": "boolean",
      "description": "Continue on row errors (skip with warning)",
      "default": false
    },
    "noCache": {
      "type": "boolean",
      "description": "Skip file cache for remote files",
      "default": false
    },
    "autoConvertToCsv": {
      "type": "boolean",
      "description": "Auto-convert Excel to CSV for large files",
      "default": false
    }
  },
  "additionalProperties": false
}
